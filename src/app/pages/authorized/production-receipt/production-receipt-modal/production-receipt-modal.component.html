<!-- production-receipt-modal.component.html -->
<div class="modal-content">

    <!-- Loading Spinner para carregamento inicial -->
    <div *ngIf="isLoading" class="loading-container">
        <ds-spinner size="large" message="Carregando recebimento..."></ds-spinner>
    </div>

    <!-- Conte√∫do do formul√°rio -->
    <div *ngIf="!isLoading" class="form-container">
        <!-- Formul√°rio -->
        <form [formGroup]="productionReceiptForm" (ngSubmit)="onSubmit()" class="receipt-form">
            <!-- üîç REFER√äNCIA INTERNA -->
            <div class="form-field">
                <ds-input icon="fa-solid fa-search" iconPosition="left" label="Refer√™ncia Interna do Desenvolvimento"
                    placeholder="Ex: 25ABC0001" formControlName="internalReference"
                    [invalid]="isFieldInvalid('internalReference')" [errorMessage]="getFieldError('internalReference')"
                    [fullWidth]="true" [required]="true" [disabled]="isEditMode" (input)="onProductionOrderSearch()">
                </ds-input>
            </div>

            <div class="search-status">
                <!-- Loading da busca -->
                <div class="text-center p-48" *ngIf="searchingProductionOrder">
                    <ds-spinner size="48px" variant="outline"></ds-spinner>
                </div>

                <!-- Desenvolvimento n√£o encontrado -->
                <div class="search-not-found" *ngIf="productionOrderNotFound && !searchingProductionOrder">
                    <ds-icon icon="fa-solid fa-triangle-exclamation" color="tertiary" fontSize="16px"></ds-icon>
                    <span class="body tertiary ml-8">Ordem de produ√ß√£o n√£o encontrada</span>
                </div>
            </div>

            <div class="d-grid columns-2 gap-24" *ngIf="productionOrderFound">
                <ds-select [fullWidth]="true" label="M√©todo de Pagamento *" formControlName="paymentMethod"
                    [options]="paymentMethodOptions" placeholder="Selecione o m√©todo"
                    [errorMessage]="getFieldError('paymentMethod')"
                    [invalid]="isFormControlInvalid(productionReceiptForm.get('paymentMethod' ))">
                </ds-select>

                <ds-select [fullWidth]="true" label="Status do Pagamento" formControlName="paymentStatus"
                    [options]="paymentStatusOptions" [errorMessage]="getFieldError('paymentStatus')"
                    [invalid]="isFormControlInvalid(productionReceiptForm.get('paymentStatus' ))">
                </ds-select>

                <ds-input [fullWidth]="true" label="Valor Total *" type="number" formControlName="totalAmount"
                    placeholder="0,00" step="0.01" min="0" icon="fa-solid fa-dollar-sign" iconPosition="left"
                    [errorMessage]="getFieldError('totalAmount')"
                    [invalid]="isFormControlInvalid(productionReceiptForm.get('totalAmount' ))">
                </ds-input>

                <ds-input [fullWidth]="true" label="Valor Pago" type="number" formControlName="paidAmount"
                    placeholder="0,00" step="0.01" min="0" icon="fa-solid fa-credit-card" iconPosition="left"
                    [errorMessage]="getFieldError('paidAmount')"
                    [invalid]="isFormControlInvalid(productionReceiptForm.get('paidAmount' ))">
                </ds-input>
            </div>
            <div class="d-grid columns-2 gap-24 mt-24" *ngIf="productionOrderFound">
                <ds-input [fullWidth]="true" label="Data de Vencimento *" type="date" formControlName="dueDate"
                    [errorMessage]="getFieldError('dueDate')"
                    [invalid]="isFormControlInvalid(productionReceiptForm.get('dueDate' ))">
                </ds-input>
            </div>

            <div class="form-field mt-24" *ngIf="productionOrderFound">
                <ds-textarea [fullWidth]="true" label="Observa√ß√µes Adicionais" formControlName="notes"
                    placeholder="Digite observa√ß√µes sobre este recebimento..." [maxlength]="1000" [rows]="3"
                    [errorMessage]="getFieldError('notes')"
                    [invalid]="isFormControlInvalid(productionReceiptForm.get('notes' ))">
                </ds-textarea>
            </div>


        </form>

        <div class="modal-actions mt-32" *ngIf="productionOrderFound">
            <ds-button label="Cancelar" type="button" variant="ghost" size="medium" [disabled]="submitting"
                (onClickEmitter)="onCancel()">
            </ds-button>

            <ds-button [label]="submitButtonText" variant="fill" size="medium" [isLoading]="submitting"
                [disabled]="submitting" (onClickEmitter)="onSubmit()">
            </ds-button>
        </div>

    </div>

</div>