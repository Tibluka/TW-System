<div class="modal-content">


    <div *ngIf="isLoading" class="loading-container">
        <ds-spinner size="large" message="Carregando recebimento..."></ds-spinner>
    </div>


    <div *ngIf="!isLoading" class="form-container">

        <form [formGroup]="productionReceiptForm" (ngSubmit)="onSubmit()" class="receipt-form">

            <div class="form-field">
                <ds-input icon="fa-solid fa-search" iconPosition="left" label="Referência Interna da Ficha de Entrega"
                    placeholder="Ex: 25ABC0001" formControlName="internalReference"
                    [invalid]="isFieldInvalid('internalReference')" [errorMessage]="getFieldError('internalReference')"
                    [fullWidth]="true" [required]="true" [disabled]="isEditMode" (input)="onDeliverySheetSearch()">
                </ds-input>
            </div>

            <div class="search-status">

                <div class="text-center p-48" *ngIf="searchingDeliverySheet">
                    <ds-spinner size="48px" variant="outline"></ds-spinner>
                </div>


                <div class="search-not-found" *ngIf="deliverySheetNotFound && !searchingDeliverySheet">
                    <ds-icon icon="fa-solid fa-triangle-exclamation" color="tertiary" fontSize="16px"></ds-icon>
                    <span class="body tertiary ml-8">Ficha de entrega não encontrada</span>
                </div>
            </div>

            <div class="d-grid columns-2 gap-24" *ngIf="deliverySheetFound">
                <ds-select [fullWidth]="true" label="Método de Pagamento *" formControlName="paymentMethod"
                    [options]="paymentMethodOptions" placeholder="Selecione o método"
                    [errorMessage]="getFieldError('paymentMethod')"
                    [invalid]="isFormControlInvalid(productionReceiptForm.get('paymentMethod' ))">
                </ds-select>

                <ds-select [fullWidth]="true" label="Status do Pagamento" formControlName="paymentStatus"
                    [options]="paymentStatusOptions" [errorMessage]="getFieldError('paymentStatus')"
                    [invalid]="isFormControlInvalid(productionReceiptForm.get('paymentStatus' ))">
                </ds-select>

                <ds-input [fullWidth]="true" label="Valor Total *" type="number" formControlName="totalAmount"
                    placeholder="0,00" step="0.01" min="0" icon="fa-solid fa-dollar-sign" iconPosition="left"
                    [errorMessage]="getFieldError('totalAmount')"
                    [invalid]="isFormControlInvalid(productionReceiptForm.get('totalAmount' ))">
                </ds-input>

                <ds-input [fullWidth]="true" label="Valor Pago" type="number" formControlName="paidAmount"
                    placeholder="0,00" step="0.01" min="0" icon="fa-solid fa-credit-card" iconPosition="left"
                    [errorMessage]="getFieldError('paidAmount')"
                    [invalid]="isFormControlInvalid(productionReceiptForm.get('paidAmount' ))">
                </ds-input>
            </div>
            <div class="d-grid columns-2 gap-24 mt-24" *ngIf="deliverySheetFound">
                <ds-input [fullWidth]="true" label="Data de Vencimento *" type="date" formControlName="dueDate"
                    [errorMessage]="getFieldError('dueDate')"
                    [invalid]="isFormControlInvalid(productionReceiptForm.get('dueDate' ))">
                </ds-input>

                <ds-input [fullWidth]="true" label="Data do Recebimento *" type="date" formControlName="paymentDate"
                    [errorMessage]="getFieldError('paymentDate')"
                    [invalid]="isFormControlInvalid(productionReceiptForm.get('paymentDate' ))">
                </ds-input>
            </div>


            <div class="form-field mt-24" *ngIf="deliverySheetFound">
                <ds-textarea [fullWidth]="true" label="Observações Adicionais" formControlName="notes"
                    placeholder="Digite observações sobre este recebimento..." [maxlength]="1000" [rows]="3"
                    [errorMessage]="getFieldError('notes')"
                    [invalid]="isFormControlInvalid(productionReceiptForm.get('notes' ))">
                </ds-textarea>
            </div>


        </form>

        <div class="modal-actions mt-32" *ngIf="deliverySheetFound">
            <ds-button label="Cancelar" type="button" variant="ghost" size="medium" [disabled]="submitting"
                (onClickEmitter)="onCancel()">
            </ds-button>

            <ds-button [label]="submitButtonText" variant="fill" size="medium" [isLoading]="submitting"
                [disabled]="submitting" (onClickEmitter)="onSubmit()">
            </ds-button>
        </div>

    </div>

</div>