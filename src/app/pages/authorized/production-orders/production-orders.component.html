<!-- pages/authorized/production-orders/production-orders.component.html -->

<div class="production-orders-container p-24">

    <!-- ‚ú® CABE√áALHO DA P√ÅGINA -->
    <div class="page-header mb-32">
        <h1 class="title-page primary-dark">Ordens de Produ√ß√£o</h1>
        <p class="body label">Gerencie todas as ordens de produ√ß√£o do sistema</p>
    </div>

    <!-- ‚ö†Ô∏è MENSAGEM DE ERRO -->
    <div *ngIf="showError" class="error-message mb-24">
        <span class="body white">{{ errorMessage }}</span>
    </div>

    <!-- üîß CONTROLES E FILTROS -->
    <div class="controls-section mb-24">

        <!-- Linha superior: Busca, Filtro Status e Bot√£o Novo -->
        <div class="controls-row mb-16">

            <!-- üîç CAMPO DE BUSCA -->
            <div class="search-container">
                <ds-input label="Buscar ordem de produ√ß√£o"
                    placeholder="Digite refer√™ncia, tipo de tecido ou observa√ß√µes..."
                    icon="fa-solid fa-magnifying-glass" iconPosition="left" [(ngModel)]="currentFilters.search"
                    (input)="onSearchChange()" [fullWidth]="true">
                </ds-input>
            </div>

            <!-- üìÇ FILTRO POR STATUS -->
            <div class="filter-container">
                <ds-select label="Filtrar por Status" [options]="statusOptions" [(ngModel)]="currentFilters.status"
                    (ngModelChange)="onStatusFilterChange()" [fullWidth]="true">
                </ds-select>
            </div>

            <!-- ‚ûï BOT√ÉO NOVA ORDEM -->
            <div class="action-container">
                <ds-button label="Nova Ordem de Produ√ß√£o" variant="fill" icon="fa-solid fa-plus"
                    (onClick)="createProductionOrder()">
                </ds-button>
            </div>
        </div>

        <!-- Linha inferior: Bot√£o limpar filtros (se houver filtros ativos) -->
        <div class="filter-actions" *ngIf="currentFilters.search || currentFilters.status">
            <ds-button label="Limpar Filtros" variant="ghost" icon="fa-solid fa-filter-circle-xmark"
                (onClick)="clearFilters()">
            </ds-button>
        </div>
    </div>

    <!-- üìä TABELA DE ORDENS DE PRODU√á√ÉO -->
    <div class="table-container" *ngIf="shouldShowTable && !loading">

        <!-- üìã CABE√áALHO DA TABELA -->
        <ds-table>
            <ds-table-row [isHeader]="true">
                <ds-table-cell align="left">Refer√™ncia</ds-table-cell>
                <ds-table-cell align="left">Desenvolvimento</ds-table-cell>
                <ds-table-cell align="left">Cliente</ds-table-cell>
                <ds-table-cell align="left">Tipo de Tecido</ds-table-cell>
                <ds-table-cell align="center">Piloto</ds-table-cell>
                <ds-table-cell align="center">Prioridade</ds-table-cell>
                <ds-table-cell align="center">Status</ds-table-cell>
                <ds-table-cell align="center">Data Cria√ß√£o</ds-table-cell>
            </ds-table-row>

            <!-- ‚ú® DADOS DAS ORDENS DE PRODU√á√ÉO -->
            <ds-table-row *ngFor="let productionOrder of productionOrders" [clickable]="true" [data]="productionOrder"
                (rowClick)="onProductionOrderClick(productionOrder)">

                <!-- Refer√™ncia Interna -->
                <ds-table-cell align="left">
                    <div class="reference-cell">
                        <span class="body primary-dark">
                            {{ productionOrder.internalReference || 'Sem Refer√™ncia' }}
                        </span>
                    </div>
                </ds-table-cell>

                <!-- Desenvolvimento -->
                <ds-table-cell align="left">
                    <div class="development-cell">
                        <div class="body primary-dark">
                            {{ productionOrder.development?.description || 'Desenvolvimento n√£o encontrado' }}
                        </div>
                        <div class="placeholder" *ngIf="productionOrder.development?.clientReference">
                            Ref: {{ productionOrder.development?.clientReference }}
                        </div>
                    </div>
                </ds-table-cell>

                <!-- Cliente -->
                <ds-table-cell align="left">
                    <div class="client-cell" *ngIf="productionOrder.development?.client">
                        <div class="body primary-dark">
                            {{ productionOrder.development?.client?.companyName }}
                        </div>
                        <div class="placeholder" *ngIf="productionOrder.development?.client?.acronym">
                            {{ productionOrder.development?.client?.acronym }}
                        </div>
                    </div>
                    <span class="body label" *ngIf="!productionOrder.development?.client">
                        Cliente n√£o encontrado
                    </span>
                </ds-table-cell>

                <!-- Tipo de Tecido -->
                <ds-table-cell align="left">
                    <span class="body primary-dark">{{ productionOrder.fabricType }}</span>
                </ds-table-cell>

                <!-- Piloto -->
                <ds-table-cell align="center">
                    <span class="pilot-badge" [ngClass]="productionOrder.pilot ? 'pilot-yes' : 'pilot-no'">
                        {{ getPilotText(productionOrder.pilot) }}
                    </span>
                </ds-table-cell>

                <!-- Prioridade -->
                <ds-table-cell align="center">
                    <span class="priority-badge" [ngClass]="'priority-' + productionOrder.priority">
                        {{ getPriorityLabel(productionOrder.priority) }}
                    </span>
                </ds-table-cell>

                <!-- Status -->
                <ds-table-cell align="center">
                    <span class="status-badge"
                        [ngClass]="'status-' + productionOrder.status.toLowerCase().replace('_', '-')">
                        {{ getStatusLabel(productionOrder.status) }}
                    </span>
                </ds-table-cell>

                <!-- Data de Cria√ß√£o -->
                <ds-table-cell align="center">
                    <span class="body label">
                        {{ formatDate(productionOrder.createdAt) }}
                    </span>
                </ds-table-cell>

            </ds-table-row>
        </ds-table>
    </div>

    <!-- üìÇ ESTADO VAZIO -->
    <div class="empty-state" *ngIf="shouldShowTable && productionOrders.length === 0 && !loading">
        <div class="empty-content">
            <ds-icon icon="fa-solid fa-clipboard-list" fontSize="48px" color="label"></ds-icon>
            <h3 class="title-modal label mb-16">Nenhuma ordem de produ√ß√£o encontrada</h3>
            <p class="body label mb-24">
                <span *ngIf="currentFilters.search || currentFilters.status">
                    Nenhuma ordem corresponde aos filtros aplicados.
                </span>
                <span *ngIf="!currentFilters.search && !currentFilters.status">
                    Crie sua primeira ordem de produ√ß√£o para come√ßar.
                </span>
            </p>
            <ds-button label="Nova Ordem de Produ√ß√£o" variant="fill" icon="fa-solid fa-plus"
                (onClick)="createProductionOrder()">
            </ds-button>
        </div>
    </div>

    <!-- üìä LOADING -->
    <div class="loading-container" *ngIf="loading">
        <div class="loading-content">
            <ds-spinner size="32px"></ds-spinner>
            <span class="body label mt-16">Carregando ordens de produ√ß√£o...</span>
        </div>
    </div>

</div>

<!-- Modal s√≥ renderiza o conte√∫do quando estiver vis√≠vel -->
<ds-modal *ngIf="isModalOpen" modalId="production-order-modal" (modalClosed)="onModalClosed($event)">
    <!-- S√≥ renderiza app-production-order-modal quando o modal est√° realmente aberto -->
    <app-production-order-modal [productionOrderId]="selectedProductionOrderId"></app-production-order-modal>
</ds-modal>